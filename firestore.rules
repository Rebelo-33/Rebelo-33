// âœ… firestore.rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /lists/{listId} {

      // Only allow read if the request includes the correct secret matching the stored one
      allow get, list: if request.query.secret == resource.data.secret;

      // Allow write only if the incoming data secret matches existing secret
      allow update, delete: if request.resource.data.secret == resource.data.secret;

      // Allow create with strict validation and require secret in data
      allow create: if request.resource.data.keys().hasAll([
        "participants", "shuffled", "secret", "drawn", "created"
      ])
      && request.resource.data.participants is list
      && request.resource.data.shuffled is list
      && request.resource.data.drawn is map
      && request.resource.data.secret is string
      && request.resource.data.created is timestamp;
    }
  }
}
