// ✅ firestore.rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ✅ Protect all lists
    match /lists/{listId} {
      
      // ✅ Anyone can read list to draw names (after auth with list name + PIN)
      allow read: if true;

      // ✅ Only allow writing if correct secret is passed in request
      allow write: if request.resource.data.secret == resource.data.secret;

      // ✅ Ensure valid structure on creation
      allow create: if request.resource.data.keys().hasAll([
        "participants", "shuffled", "secret", "drawn", "created"
      ])
      && request.resource.data.participants is list
      && request.resource.data.drawn is map
      && request.resource.data.secret is string;
    }
  }
}
