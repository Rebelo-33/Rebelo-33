// âœ… firestore.rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /lists/{listId} {

      // Allow read (get/list) only if client provides a matching secret string in query
      allow get, list: if request.query.secret == resource.data.secret;

      // Allow update/delete only if secret matches (in request data)
      allow update, delete: if request.resource.data.secret == resource.data.secret;

      // Allow create only if valid structure and includes secret
      allow create: if request.resource.data.keys().hasAll([
        "participants", "shuffled", "drawn", "secret", "created"
      ])
      && request.resource.data.participants is list
      && request.resource.data.shuffled is list
      && request.resource.data.drawn is map
      && request.resource.data.secret is string
      && request.resource.data.created is timestamp;
    }
  }
}
