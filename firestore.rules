rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Match all documents under the "lists" collection
    match /lists/{listId} {

      // Allow GET (read) if query param "pin" and "name" match AND a valid "secretCode" if required
      allow get: if
        request.query.name == resource.data.name &&
        request.query.pin == resource.data.pin;

      // Allow update or delete only if the correct secretCode is provided in the incoming data
      allow update, delete: if
        request.resource.data.secretCode == resource.data.secretCode;

      // Allow creation of a list only if proper structure is used
      allow create: if
        request.resource.data.keys().hasAll([
          "participants", "drawn", "name", "pin", "secretCode", "timestamp"
        ]) &&
        request.resource.data.participants is list &&
        request.resource.data.drawn is list &&
        request.resource.data.name is string &&
        request.resource.data.pin is string &&
        request.resource.data.secretCode is string &&
        request.resource.data.timestamp is number;
    }
  }
}
